name: 'âš™ï¸ Setup node'
description: 'Setup node with project version and install dependencies'

inputs:
  version:
    description: 'Node.js version to use'
    required: false
  npm_token:
    description: 'NPM authentication token'
    required: false
    default: ''

runs:
  using: 'composite'
  steps:
    - name: Authenticate npm ğŸ”‘
      shell: bash
      run: echo "//registry.npmjs.org/:_authToken=${{ inputs.npm_token }}" > ~/.npmrc

    - name: Setup Node âš™ï¸
      uses: actions/setup-node@v4
      with:
        node-version: ${{ inputs.version }}
        node-version-file: '.nvmrc'
        cache: 'npm'

    - name: Install dependencies ğŸ“¥
      shell: bash
      run: |
        rm -rf node_modules
        npm ci || npm install

        # Fix patch-package: ensure module exists
        npm install parse-gitignore@^2.0.0 --save-dev
